# Tauri è‡ªåŠ¨æ›´æ–° - Release ç®¡ç†è„šæœ¬

è¿™ä¸ªè„šæœ¬ç”¨äºè‡ªåŠ¨åŒ– Tauri åº”ç”¨çš„æ„å»ºã€æ‰“åŒ…å’Œå‘å¸ƒæµç¨‹ï¼Œæ”¯æŒè‡ªåŠ¨ä¸Šä¼ åˆ° Gitea Releaseã€‚

## åŠŸèƒ½ç‰¹æ€§

- âœ… **æ™ºèƒ½ç‰ˆæœ¬ç®¡ç†**: è‡ªåŠ¨è¯»å–å½“å‰ç‰ˆæœ¬ï¼Œæä¾›è¡¥ä¸/æ¬¡ç‰ˆæœ¬/ä¸»ç‰ˆæœ¬å‡çº§å»ºè®®
- âœ… **è‡ªåŠ¨æ„å»º**: å¯é€‰æ‹©æ˜¯å¦é‡æ–°æ„å»ºåº”ç”¨
- âœ… **æ–‡ä»¶é‡å‘½å**: è‡ªåŠ¨å°†æ„å»ºäº§ç‰©é‡å‘½åä¸ºåŒ…å«ç‰ˆæœ¬å·å’Œæ¶æ„çš„æ ¼å¼
- âœ… **ç”Ÿæˆ latest.json**: ä¸º Tauri æ›´æ–°å™¨ç”Ÿæˆé…ç½®æ–‡ä»¶
- âœ… **è‡ªåŠ¨ä¸Šä¼ **: æ”¯æŒè‡ªåŠ¨ä¸Šä¼ åˆ° Gitea Release
- âœ… **è‡ªåŠ¨æ›´æ–°ç‰ˆæœ¬å·**: å®Œæˆåè‡ªåŠ¨æ›´æ–° `tauri.conf.json` å’Œ `package.json` ä¸­çš„ç‰ˆæœ¬å·
- âœ… **å¤šå¹³å°æ”¯æŒ**: æ”¯æŒ macOS (ARM64/x64)ã€Linux (x64)ã€Windows (x64)

## å¿«é€Ÿå¼€å§‹

### 1. åˆ›å»ºé…ç½®æ–‡ä»¶

å¤åˆ¶ç¤ºä¾‹é…ç½®æ–‡ä»¶å¹¶ä¿®æ”¹ï¼š

```bash
cp .updater.config.example.json .updater.config.json
```

ç¼–è¾‘ `.updater.config.json`:

```json
{
  "gitea": {
    "url": "http://gitea.watchmonkey.icu",
    "owner": "niyyzf",
    "repo": "watch-monkey-app",
    "token": "your-gitea-token-here",
    "autoUpload": true
  },
  "app": {
    "name": "watch-monkey-app"
  },
  "build": {
    "command": "bun run tauri build",
    "privateKeyPath": ".tauri/watch-monkey.key",
    "privateKeyPassword": ""
  }
}
```

### 2. è·å– Gitea Personal Access Token

1. ç™»å½• Gitea
2. ç‚¹å‡»å³ä¸Šè§’å¤´åƒ â†’ è®¾ç½®
3. å·¦ä¾§èœå•é€‰æ‹©"åº”ç”¨"
4. åœ¨"ç®¡ç†è®¿é—®ä»¤ç‰Œ"éƒ¨åˆ†ï¼Œç‚¹å‡»"ç”Ÿæˆæ–°ä»¤ç‰Œ"
5. é€‰æ‹©æƒé™ï¼ˆè‡³å°‘éœ€è¦ `repo` æƒé™ï¼‰
6. å¤åˆ¶ç”Ÿæˆçš„ token åˆ°é…ç½®æ–‡ä»¶

### 3. è¿è¡Œè„šæœ¬

```bash
# äº¤äº’å¼è¿è¡Œï¼ˆæ¨èï¼‰
bash scripts/create-release-json.sh

# æˆ–æŒ‡å®šç‰ˆæœ¬å·
bash scripts/create-release-json.sh 0.2.0

# å®Œæ•´å‚æ•°
bash scripts/create-release-json.sh <version> <gitea-url> <owner> <repo>
```

## ä½¿ç”¨æµç¨‹

### äº¤äº’å¼æµç¨‹

1. **é€‰æ‹©ç‰ˆæœ¬å·**
   - è„šæœ¬ä¼šè¯»å–å½“å‰ç‰ˆæœ¬å¹¶æä¾›å‡çº§å»ºè®®
   - å¯ä»¥é€‰æ‹©è¡¥ä¸ç‰ˆæœ¬ã€æ¬¡ç‰ˆæœ¬ã€ä¸»ç‰ˆæœ¬æˆ–è‡ªå®šä¹‰ç‰ˆæœ¬

2. **æ£€æŸ¥æ„å»ºäº§ç‰©**
   - å¦‚æœå­˜åœ¨æ„å»ºäº§ç‰©ï¼Œä¼šæ˜¾ç¤ºåˆ—è¡¨å¹¶è¯¢é—®æ˜¯å¦é‡æ–°æ„å»º
   - å¦‚æœä¸å­˜åœ¨ï¼Œä¼šè¯¢é—®æ˜¯å¦ç°åœ¨æ„å»º

3. **æ„å»ºåº”ç”¨**ï¼ˆå¦‚æœé€‰æ‹©ï¼‰
   - è‡ªåŠ¨è®¾ç½®ç­¾åç¯å¢ƒå˜é‡
   - æ‰§è¡Œæ„å»ºå‘½ä»¤
   - æ£€æŸ¥æ„å»ºç»“æœ

4. **é‡å‘½åæ„å»ºæ–‡ä»¶**
   - è‡ªåŠ¨å°†æ–‡ä»¶é‡å‘½åä¸ºåŒ…å«ç‰ˆæœ¬å·å’Œæ¶æ„çš„æ ¼å¼
   - ä¾‹å¦‚: `watch-monkey-app.app.tar.gz` â†’ `watch-monkey-app_0.2.0_aarch64.app.tar.gz`

5. **è¾“å…¥æ›´æ–°è¯´æ˜**
   - è¾“å…¥æœ¬æ¬¡æ›´æ–°çš„è¯´æ˜ï¼ˆæ”¯æŒå¤šè¡Œï¼‰
   - æŒ‰ `Ctrl+D` å®Œæˆè¾“å…¥

6. **ç”Ÿæˆ latest.json**
   - è‡ªåŠ¨æ‰«ææ„å»ºäº§ç‰©
   - ç”ŸæˆåŒ…å«æ‰€æœ‰å¹³å°çš„æ›´æ–°é…ç½®æ–‡ä»¶

7. **ä¸Šä¼ åˆ° Gitea**ï¼ˆå¯é€‰ï¼‰
   - å¦‚æœé…ç½®äº† tokenï¼Œä¼šè¯¢é—®æ˜¯å¦ä¸Šä¼ 
   - è‡ªåŠ¨åˆ›å»º Release
   - ä¸Šä¼ æ‰€æœ‰æ„å»ºäº§ç‰©å’Œç­¾åæ–‡ä»¶
   - ä¸Šä¼  latest.json

8. **æ›´æ–°ç‰ˆæœ¬å·**
   - è‡ªåŠ¨æ›´æ–° `src-tauri/tauri.conf.json` ä¸­çš„ç‰ˆæœ¬å·
   - è‡ªåŠ¨æ›´æ–° `package.json` ä¸­çš„ç‰ˆæœ¬å·
   - ç¡®ä¿ä¸‹æ¬¡æ„å»ºä½¿ç”¨æ–°ç‰ˆæœ¬

## é…ç½®è¯´æ˜

### gitea é…ç½®

| å­—æ®µ | è¯´æ˜ | å¿…éœ€ |
|------|------|------|
| `url` | Gitea æœåŠ¡å™¨åœ°å€ | âœ… |
| `owner` | ä»“åº“æ‰€æœ‰è€… | âœ… |
| `repo` | ä»“åº“åç§° | âœ… |
| `token` | Personal Access Token | ä¸Šä¼ æ—¶å¿…éœ€ |
| `autoUpload` | æ˜¯å¦è‡ªåŠ¨ä¸Šä¼ ï¼ˆä¸è¯¢é—®ï¼‰ | âŒ |

### app é…ç½®

| å­—æ®µ | è¯´æ˜ | å¿…éœ€ |
|------|------|------|
| `name` | åº”ç”¨åç§° | âœ… |

### build é…ç½®

| å­—æ®µ | è¯´æ˜ | å¿…éœ€ |
|------|------|------|
| `command` | æ„å»ºå‘½ä»¤ | âœ… |
| `privateKeyPath` | ç­¾åç§é’¥è·¯å¾„ | è‡ªåŠ¨æ›´æ–°å¿…éœ€ |
| `privateKeyPassword` | ç§é’¥å¯†ç  | âŒ |

## æ–‡ä»¶å‘½åè§„åˆ™

æ„å»ºäº§ç‰©ä¼šè¢«é‡å‘½åä¸ºä»¥ä¸‹æ ¼å¼ï¼š

- **macOS ARM64**: `{app-name}_{version}_aarch64.app.tar.gz`
- **macOS x64**: `{app-name}_{version}_x64.app.tar.gz`
- **Linux x64**: `{app-name}_{version}_amd64.AppImage.tar.gz`
- **Windows x64**: `{app-name}_{version}_x64-setup.nsis.zip`

æ¯ä¸ªæ–‡ä»¶éƒ½ä¼šæœ‰å¯¹åº”çš„ `.sig` ç­¾åæ–‡ä»¶ã€‚

## Gitea API ä½¿ç”¨

è„šæœ¬ä½¿ç”¨ä»¥ä¸‹ Gitea API ç«¯ç‚¹ï¼š

1. **æ£€æŸ¥ Release**: `GET /api/v1/repos/{owner}/{repo}/releases/tags/{tag}`
2. **åˆ›å»º Release**: `POST /api/v1/repos/{owner}/{repo}/releases`
3. **åˆ é™¤ Release**: `DELETE /api/v1/repos/{owner}/{repo}/releases/{id}`
4. **ä¸Šä¼ é™„ä»¶**: `POST /api/v1/repos/{owner}/{repo}/releases/{id}/assets`

## å¸¸è§é—®é¢˜

### 1. æ²¡æœ‰æ‰¾åˆ°æ„å»ºäº§ç‰©

**åŸå› **: æœªè¿è¡Œæ„å»ºæˆ–ç­¾åå¯†é’¥æœªé…ç½®

**è§£å†³**:
```bash
# è®¾ç½®ç­¾åå¯†é’¥
export TAURI_SIGNING_PRIVATE_KEY=$(cat .tauri/watch-monkey.key)

# è¿è¡Œæ„å»º
bun run tauri build
```

### 2. ä¸Šä¼ å¤±è´¥

**åŸå› **: Token æƒé™ä¸è¶³æˆ–ç½‘ç»œé—®é¢˜

**è§£å†³**:
- ç¡®ä¿ Token æœ‰ `repo` æƒé™
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- æŸ¥çœ‹é”™è¯¯å“åº”ä¿¡æ¯

### 3. ç­¾åæ–‡ä»¶ä¸å­˜åœ¨

**åŸå› **: æœªé…ç½®ç­¾åå¯†é’¥

**è§£å†³**:
```bash
# ç”Ÿæˆç­¾åå¯†é’¥å¯¹
bun tauri signer generate -- -w .tauri/watch-monkey.key

# åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®è·¯å¾„
"privateKeyPath": ".tauri/watch-monkey.key"
```

## å®‰å…¨å»ºè®®

1. **ä¸è¦æäº¤é…ç½®æ–‡ä»¶**: å°† `.updater.config.json` æ·»åŠ åˆ° `.gitignore`
2. **ä¿æŠ¤ Token**: ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç  token
3. **ä¿æŠ¤ç§é’¥**: ç­¾åç§é’¥åº”è¯¥å®‰å…¨å­˜å‚¨ï¼Œä¸è¦æäº¤åˆ°ä»“åº“
4. **å®šæœŸæ›´æ–° Token**: å®šæœŸè½®æ¢ Personal Access Token

## ç¤ºä¾‹è¾“å‡º

```
================================================
  Tauri è‡ªåŠ¨æ›´æ–° - Gitea Release JSON ç”Ÿæˆå™¨
================================================

ğŸ“„ è¯»å–é…ç½®æ–‡ä»¶: .updater.config.json
   âœ… å·²åŠ è½½é…ç½®

ğŸ’¡ å½“å‰ç‰ˆæœ¬: 0.1.0

   å»ºè®®ç‰ˆæœ¬:
   [1] è¡¥ä¸ç‰ˆæœ¬ (Patch): 0.1.1  - ä¿®å¤ bug
   [2] æ¬¡ç‰ˆæœ¬ (Minor):   0.2.0  - æ–°å¢åŠŸèƒ½
   [3] ä¸»ç‰ˆæœ¬ (Major):   1.0.0  - é‡å¤§æ›´æ–°
   [0] è‡ªå®šä¹‰ç‰ˆæœ¬

ğŸ“¦ è¯·é€‰æ‹©ç‰ˆæœ¬ç±»å‹ (1/2/3/0) æˆ–ç›´æ¥è¾“å…¥ç‰ˆæœ¬å· [é»˜è®¤: 1]: 2

ğŸ“‹ é…ç½®ä¿¡æ¯:
   ç‰ˆæœ¬: 0.2.0
   åº”ç”¨: watch-monkey-app
   æœåŠ¡å™¨: http://gitea.watchmonkey.icu
   ä»“åº“: niyyzf/watch-monkey-app

âœ… æ‰¾åˆ°ç°æœ‰æ„å»ºäº§ç‰© (1 ä¸ªå¹³å°)

   å·²æœ‰æ„å»º:
   â€¢ macOS: watch-monkey-app_0.1.1_aarch64.app.tar.gz

ğŸ”„ æ˜¯å¦é‡æ–°æ„å»ºåº”ç”¨ï¼Ÿ(y/N): n

ğŸ” æ­£åœ¨æ‰«ææ„å»ºäº§ç‰©...

ğŸ“ é‡å‘½å macOS æ„å»ºæ–‡ä»¶:
   watch-monkey-app.app.tar.gz â†’ watch-monkey-app_0.2.0_aarch64.app.tar.gz
   watch-monkey-app.app.tar.gz.sig â†’ watch-monkey-app_0.2.0_aarch64.app.tar.gz.sig

ğŸ“ è¯·è¾“å…¥æ›´æ–°è¯´æ˜ (è¾“å…¥å®ŒæˆåæŒ‰ Ctrl+D):
- æ–°å¢åŠŸèƒ½ A
- ä¿®å¤ bug B
- æ€§èƒ½ä¼˜åŒ–
^D

  âœ… æ‰¾åˆ° macOS ARM64 æ„å»º: watch-monkey-app_0.2.0_aarch64.app.tar.gz

================================================
âœ… latest.json å·²æˆåŠŸåˆ›å»ºï¼
================================================

ğŸ“Š åŒ…å« 1 ä¸ªå¹³å°çš„æ›´æ–°ä¿¡æ¯

================================================
ğŸš€ è‡ªåŠ¨ä¸Šä¼ å·²å¯ç”¨
================================================

å¼€å§‹ä¸Šä¼ åˆ° Gitea...

ğŸ” æ£€æŸ¥ Release v0.2.0 æ˜¯å¦å­˜åœ¨...
ğŸ“¦ åˆ›å»º Release v0.2.0...
   âœ… Release åˆ›å»ºæˆåŠŸ (ID: 123)

ğŸ“¤ ä¸Šä¼ æ„å»ºäº§ç‰©...

   ğŸ“¤ ä¸Šä¼ : watch-monkey-app_0.2.0_aarch64.app.tar.gz
      âœ… æˆåŠŸ
   ğŸ“¤ ä¸Šä¼ : watch-monkey-app_0.2.0_aarch64.app.tar.gz.sig
      âœ… æˆåŠŸ
   ğŸ“¤ ä¸Šä¼ : latest.json
      âœ… æˆåŠŸ

================================================
âœ… ä¸Šä¼ å®Œæˆï¼æˆåŠŸä¸Šä¼  3 ä¸ªæ–‡ä»¶
================================================

ğŸ”— Release åœ°å€:
   http://gitea.watchmonkey.icu/niyyzf/watch-monkey-app/releases/tag/v0.2.0

ğŸ”— æ›´æ–°æ£€æŸ¥åœ°å€:
   http://gitea.watchmonkey.icu/niyyzf/watch-monkey-app/releases/download/v0.2.0/latest.json
```

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## è®¸å¯è¯

MIT

